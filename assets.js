// export ???? ??????? => ?????? ???? JSON
function exportAllData(filename = 'portal-backup.json') {
  const data = {
    accounts: localStorage.getItem('my_portal_accounts_v2') || '[]',
    posts: localStorage.getItem('my_portal_posts_v2') || '[]'
  };
  const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

// import ?? ???? JSON (???? ???? ???? ?????? export ??? ?? ????? ????)
function importAllDataFromObject(obj) {
  // obj ???? ?? ??? JS ???? ?? JSON.parse(fileContent)
  if(obj.accounts !== undefined) localStorage.setItem('my_portal_accounts_v2', JSON.stringify(JSON.parse(obj.accounts || '[]')));
  if(obj.posts !== undefined) localStorage.setItem('my_portal_posts_v2', JSON.stringify(JSON.parse(obj.posts || '[]')));
  // ??? ?? ???????? UI ?? ???? ??
  renderAvatar();
  renderFeed();
}

// ????: ?????? ???? ?? input[type=file]
function importAllDataFromFile(file) {
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const obj = JSON.parse(e.target.result);
      importAllDataFromObject(obj);
      alert('??????? ?? ?????? ??????? ????');
    } catch(err) {
      alert('???? ??????? ???');
    }
  };
  reader.readAsText(file);
}
